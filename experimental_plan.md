# Experimental Plan: Evaluating RAG-SLAM

This document outlines the experimental plan to evaluate the performance of a semantic loop-closure mechanism (RAG-SLAM) against a traditional geometric baseline.

## 1. Experimental Setup

### 1.1. Dataset

We will use the **TUM RGB-D dataset**, specifically the `freiburg1_xyz` sequence.

*   **Justification:** The TUM RGB-D dataset is a widely recognized benchmark for evaluating indoor SLAM systems. It provides synchronized RGB-D video streams and highly accurate ground truth trajectories from a motion capture system, which is crucial for quantitative evaluation. The `freiburg1_xyz` sequence involves a person moving a Kinect sensor around a desk, which provides a suitable trajectory length and potential for loop closures.

### 1.2. Systems for Comparison

We will compare two SLAM system configurations:

*   **System A (Baseline):** A standard, state-of-the-art geometric SLAM system. We will use **ORB-SLAM3** in its monocular-inertial configuration, with its standard geometric loop closure mechanism enabled. The semantic components will be disabled.

*   **System B (Ours):** The same **ORB-SLAM3** system, but with the standard loop closure mechanism augmented by our **Gemini-based semantic RAG pipeline**. When a potential loop closure is detected geometrically, the semantic pipeline will be triggered to verify the loop closure based on scene understanding.

## 2. Evaluation Metrics

### 2.1. Primary Metric: Absolute Trajectory Error (ATE)

The primary metric for evaluating the performance of the two systems will be the **Absolute Trajectory Error (ATE)**.

*   **Definition:** ATE measures the global consistency of the estimated trajectory by comparing it to the ground truth trajectory. It is calculated as the root-mean-square error (RMSE) over the differences between the positions of the estimated and ground truth trajectories after they have been aligned.

*   **Justification:** ATE is a suitable metric for this experiment because it directly reflects the accumulated drift of the SLAM system over time. A successful loop closure significantly reduces drift, which will be clearly visible as a lower ATE value. By comparing the ATE of System A and System B, we can directly quantify the impact of the semantic loop closure mechanism on the overall accuracy of the trajectory.

## 3. Methodology

The experiment will be conducted as follows:

1.  **Dataset Preparation:**
    *   Download the `freiburg1_xyz` sequence from the TUM RGB-D dataset website.
    *   For each keyframe generated by the SLAM system, a caption will be generated using a pre-trained vision-to-text model (e.g., a model from the Hugging Face Transformers library). These captions will be stored and associated with their respective keyframes.

2.  **System Execution:**
    *   **Run System A (Baseline):** Execute ORB-SLAM3 on the `freiburg1_xyz` sequence. The estimated trajectory will be saved to a file in the TUM trajectory file format.
    *   **Run System B (Ours):** Execute the modified ORB-SLAM3 (with the RAG pipeline) on the same `freiburg1_xyz` sequence. The estimated trajectory will also be saved in the TUM format.

3.  **Metric Computation:**
    *   Use a standard SLAM evaluation tool (e.g., the `evo` Python package) to compute the Absolute Trajectory Error (ATE) for both systems.
    *   The tool will align the estimated trajectories with the ground truth trajectory and calculate the RMSE of the translational error.

4.  **Data Analysis:**
    *   Compare the ATE values obtained for System A and System B.
    *   Plot the trajectories of both systems against the ground truth to visually inspect the differences and identify areas where the semantic loop closure provided a significant correction.

## 4. Success Criteria

The experiment will be considered a success if **System B (Ours)** demonstrates a statistically significant reduction in **Absolute Trajectory Error (ATE)** compared to **System A (Baseline)**.

*   **Primary Goal:** To achieve a reduction in ATE of at least **15%** for System B relative to System A on the `freiburg1_xyz` trajectory.
*   **Qualitative Goal:** Visual inspection of the plotted trajectories should clearly show that System B's trajectory aligns more closely with the ground truth, particularly after a successful semantic loop closure.

This will validate the hypothesis that the RAG-based semantic loop closure mechanism effectively reduces odometry drift in a real-world indoor environment.

---

## 5. Ablation Study: Impact of MetaSpatial Physics-Aware Pre-training

This section details an ablation study to measure the impact of the MetaSpatial physics-aware pre-training on the LLAMA-VLM's performance within the SLAM system.

### 5.1. Study Goal

The primary goal is to quantify the reduction in physically impossible or nonsensical layout constraints generated by the SLAM agent after the LLAMA-VLM has been pre-trained with MetaSpatial. This will isolate and measure the contribution of the physics-aware pre-training to the system's overall robustness and common-sense reasoning capabilities.

### 5.2. Systems for Comparison

Two system configurations will be compared:

*   **System 1 (No Physics Pre-training):** The full RAG-SLAM agent using the LLAMA-VLM that has been fine-tuned with PPO (from Milestone 3) but *has not* undergone MetaSpatial pre-training. This system represents the baseline performance without explicit physics-based knowledge.

*   **System 2 (With Physics Pre-training):** The full RAG-SLAM agent using the LLAMA-VLM that has been fine-tuned with PPO *and* has undergone the MetaSpatial pre-training. This system represents the enhanced agent with our proposed physics-aware pre-training.

### 5.3. Evaluation Metric: Impossible Constraint Rate (ICR)

The primary evaluation metric will be the **"Impossible Constraint Rate" (ICR)**.

*   **Definition:** ICR is defined as the ratio of physically impossible constraints proposed by the agent to the total number of constraints it proposes.
    ```
    ICR = (Number of physically impossible constraints proposed) / (Total number of constraints proposed)
    ```

*   **Examples of Impossible Constraints:**
    *   **Object Collision:** Proposing that two solid objects occupy the same physical space (e.g., "the chair is inside the desk").
    *   **Floating Objects:** Proposing that an object is suspended in mid-air without any visible support (e.g., "a book is floating above the table").
    *   **Object Interpenetration:** Proposing that one object passes through another solid object (e.g., "the lamp is inside the wall").
    *   **Invalid Object Placement:** Proposing a placement that violates basic physical principles (e.g., "the monitor is placed upside down on the ceiling").

### 5.4. Methodology

The experimental procedure is as follows:

1.  **Trajectory Execution:** Run both System 1 and System 2 on the identical `freiburg1_xyz` trajectory from the TUM RGB-D dataset. This ensures that both systems are exposed to the exact same sequence of visual inputs.

2.  **Constraint Logging:** During each run, every semantic layout constraint proposed by the LLAMA-VLM will be logged to a structured file (e.g., JSON or CSV). Each log entry will include the constraint itself, the timestamp, and the keyframe ID.

3.  **Constraint Classification:** After each run is complete, a human reviewer (or a validation script) will analyze the log file. Each proposed constraint will be classified into one of two categories:
    *   **Valid:** The constraint is physically plausible and consistent with the visual evidence.
    *   **Impossible:** The constraint violates one or more physical principles as defined in Section 5.3.

4.  **ICR Calculation:** Calculate the Impossible Constraint Rate (ICR) for both System 1 and System 2 using the formula defined above.

### 5.5. Success Criteria

The ablation study will be considered successful if **System 2 (With Physics Pre-training)** demonstrates a statistically significant reduction in the Impossible Constraint Rate compared to **System 1 (No Physics Pre-training)**.

*   **Quantitative Goal:** To achieve a reduction in the ICR of at least **50%** for System 2 relative to System 1.
*   **Qualitative Goal:** A review of the proposed constraints should show a clear qualitative improvement, with System 2 generating more physically grounded and common-sense layout suggestions.

This outcome would provide strong evidence that the MetaSpatial pre-training is a critical component for improving the reliability and real-world applicability of LLM-based SLAM agents.